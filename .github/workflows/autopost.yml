name: Auto Post to Facebook

on:
  schedule:
    - cron: "0 * * * *"   # jalan tiap 3 jam
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Baca caption dari quotes.txt dan posting ke Facebook
        env:
          FB_TOKEN: ${{ secrets.FB_LONG_LIVED_TOKEN }}
        run: |
          # Baca semua baris dari quotes.txt
          mapfile -t CAPTIONS < quotes.txt

          # Pilih caption acak
          RANDOM_INDEX=$((RANDOM % ${#CAPTIONS[@]}))
          CAPTION=${CAPTIONS[$RANDOM_INDEX]}

          # Tambahkan link affiliate Kang
          MESSAGE="$CAPTION

# 🛍️ Cek promo Shopee 👉 https://id.shp.ee/e2eqze5"

          # Posting ke Facebook
          curl -X POST "https://graph.facebook.com/v19.0/me/feed" \
          -F "message=$MESSAGE" \
          -F "access_token=${FB_TOKEN}"
